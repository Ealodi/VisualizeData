<html> 
  <head> 
        <meta charset="utf-8"> 
        <title>HelloWorld</title>
        <script src="http://d3js.org/d3.v5.min.js" charset="utf-8"></script>
        <style>
            .axis path,
            .axis line{
                fill: none;
                stroke: black;
                shape-rendering: crispEdges;
            }
            .Mytext text {
                font-family: sans-serif;
                font-size: 11px;
            }
            .axis text {
                font-family: sans-serif;
                font-size: 11px;
            }
            </style>
  </head> 
    <body> 
    <script>  
        var width = 400;
        var height = 400;

        var data = [1.2, 2.3, 0.9, 1.5, 3.3];

        //画布周边的空白
        var padding = {left:30, right:30, top:20, bottom:20};
        var max = d3.max(data);
        //定义比例尺
        var linear = d3.scaleLinear()
              .domain([0, max])
              .range([0, height - padding.bottom - padding.top]);
        //x轴的比例尺 序数比例尺
        var xScale = d3.scaleBand()
            .domain(d3.range(data.length))
            .range([0, width - padding.left - padding.right]);

        //y轴的比例尺 线性比例尺
        var yScale = d3.scaleLinear()
            .domain([0,max])
            .range([height - padding.top - padding.bottom, 0]);

        //定义x轴
        var xAxis = d3.axisBottom()
            .scale(xScale);

        //定义y轴
        var yAxis = d3.axisLeft()
            .scale(yScale);

        var p = d3.select("body");
        p.append("svg").attr("id","svg_1").attr("width",width).attr("height",height);

        
        var rectPadding = 20;
        //添加矩形
        var svg = d3.select("#svg_1");
        svg.selectAll(".Myrect").data(data).enter().append("rect")
            .attr("class","Myrect")
            .attr("transform","translate(" + padding.left + "," + padding.top + ")")
            .attr("x",function(d,i){return xScale(i) + rectPadding / 2;})
            .attr("y",function(d){return yScale(d);})
            .attr("width",xScale.bandwidth() - rectPadding) //rangeband是坐标轴每格之间的长度
            .attr("height",function(d,i){return linear(d);})
            .attr("y",function(d){return yScale(d);})
            .attr("fill","steelblue")
            .on("click",function(d){console.log("1");})
            .on("mouseover",function(d,i){
                d3.select(this)
                    .transition()
                    .duration(100)
                    .attr("fill","yellow");
            })
            .on("mouseout",function(d,i){
                d3.select(this)
                    .transition()
                    .duration(500)
                    .attr("fill","steelblue");
            });

        //添加数值
        svg.selectAll(".Mytext").data(data).enter().append("text")
            .attr("class","Mytext")
            .attr("transform","translate(" + padding.left + "," + padding.top + ")")
            .text(function(d){return d;})
            .attr("x",0)
            .attr("y",function(d){return yScale(d) + 20;})
            .transition()
            .delay(function(d,i){return i * 200;})
            .duration(2000)
            .ease(d3.easeBounce)            
            .attr("x",function(d,i){return xScale(i) + rectPadding});
        //添加x轴
        svg.append("g")
          .attr("class","axis")
          .attr("transform","translate(" + padding.left + "," + (height - padding.bottom) + ")")
          .call(xAxis); 

        //添加y轴
        svg.append("g")
          .attr("class","axis")
          .attr("transform","translate(" + padding.left + "," + padding.top + ")")
          .call(yAxis);

    </script>
    <script>
        //饼状图
        var width = 400,height = 400;
        var dataset = [ 30 , 10 , 43 , 55 , 13 ];
        var color = d3.scaleOrdinal(d3.schemeCategory10); 
        var pie = d3.pie();
        var piedata = pie(dataset);
        var outerRadius = 150; //外半径
        var innerRadius = 0; //内半径，为0则中间没有空白    
        var arc = d3.arc()  //弧生成器
            .innerRadius(innerRadius)   //设置内半径
            .outerRadius(outerRadius);  //设置外半径
        //添加svg
        var svg = d3.select("body").append("svg")
            .attr("id","svg_2")
            .attr("height",height)
            .attr("width",width)
            .attr("transform","translate("+width / 2+",0"+")");
        var arcs = svg.selectAll("g")
            .data(piedata)
            .enter()
            .append("g")
            .attr("transform","translate("+ width / 2 +","+ (width/2) +")")

        arcs.append("path")
            .attr("fill",function(d,i){
                return color(i);
            })
            .attr("d",function(d){
                return arc(d);   //调用弧生成器，得到路径值
            })
            .on("mouseover",function(d,i){
                var path = d3.select(this);
                path.transition()
                    .duration(100)
                    .attr("fill","lightyellow")
                    .attr("d", d3.arc().innerRadius(innerRadius).outerRadius(outerRadius * 1.1))
                    .attr("stroke","black")
                    .attr("stroke-width",1);
            })
            .on("mouseout",function(d,i){
                d3.select(this)
                    .transition()
                    .duration(500)
                    .attr("fill",color(i))
                    .attr("d",arc)
                    .attr("stroke","white")
                    .attr("stroke-width",0);
            });
        //添加文本
        arcs.append("text")
            .attr("transform",function(d){
                return "translate(" + arc.centroid(d) + ")";
            })
            .attr("text-anchor","middle")
            .text(function(d){
                return d.data;
            });
    </script>
    <script>
        //地图
        var svg = d3.select("body")
            .append("svg")
            .attr("width", 500)
            .attr("height", 500);
        
        d3.json("ChinaGeoFull.json").then(function(geoData){
            var path = d3.geoPath();
            var pathString = path(geoData);
            console.log(pathString);
            svg.append("path")
                .attr("d", pathString)
                .style("fill", "steelblue")
                .style("stroke", "white");
            }).catch(function(error) {
            console.error("Error loading GeoJSON file:", error);
        });
    </script>
    </body> 
</html>


