"use strict";var fileName,opacity,layerPath,maxFreq,spinner,svg=d3.select("body").append("svg").attr({id:"mainsvg",width:1400,height:660}),fileList=["WikiNews","Huffington","CrooksAndLiars","EmptyWheel","Esquire","FactCheck","VIS_papers","IMDB","PopCha","Cards_PC","Cards_Fries","QuantumComputing","test"],initialDataset="EmptyWheel",categories=["person","location","organization","miscellaneous"],axisGroup=svg.append("g").attr("id","axisGroup"),xGridlinesGroup=svg.append("g").attr("id","xGridlinesGroup"),mainGroup=svg.append("g").attr("id","main"),legendGroup=svg.append("g").attr("id","legend");function addDatasetsOptions(){for(var t=document.getElementById("datasetsSelect"),e=0;e<fileList.length;e++){var a=fileList[e],n=document.createElement("option");n.textContent=a,n.value=a,n["data-image"]="images2/datasetThumnails/"+fileList[e]+".png",t.appendChild(n)}document.getElementById("datasetsSelect").value=initialDataset,fileName=document.getElementById("datasetsSelect").value,loadData()}function loadData(){var t=document.getElementById("loadingSpinner");spinner=new Spinner({lines:25,length:15,width:5,radius:25,color:"#000",speed:2,trail:50,className:"spinner"}).spin(t),0<=(fileName="data/"+fileName+".tsv").indexOf("test")?(categories=["content"],loadBlogPostData(draw,initTop),document.getElementById("rel").checked=!0):0<=fileName.indexOf("Cards_Fries")?(categories=["increases_activity","decreases_activity"],loadAuthorData(draw,initTop)):0<=fileName.indexOf("Cards_PC")?(categories=["adds_modification","removes_modification","increases","decreases","binds","translocation"],loadAuthorData(draw,initTop)):0<=fileName.indexOf("PopCha")?(categories=["Comedy","Drama","Action","Fantasy","Horror"],loadAuthorData(draw,initTop)):0<=fileName.indexOf("IMDB")?(categories=["Comedy","Drama","Action","Family"],loadAuthorData(draw,initTop)):0<=fileName.indexOf("VIS")?(categories=["Vis","VAST","InfoVis","SciVis"],loadAuthorData(draw,initTop)):0<=fileName.indexOf("QuantumComputing")?(fileName="data/"+fileName+".tsv",categories=["Unknown citation","Have citation","Affiliations","Author"],initTop=15,loadQuantumComputing(draw,initTop)):0<=fileName.indexOf("Huffington")?(categories=["person","location","organization","miscellaneous"],loadBlogPostData(draw,initTop),document.getElementById("rel").checked=!0):(categories=["person","location","organization","miscellaneous"],loadBlogPostData(draw,initTop))}function loadNewData(t){legendGroup.selectAll("*").remove(),axisGroup.selectAll("*").remove(),xGridlinesGroup.selectAll("*").remove(),mainGroup.selectAll("*").remove(),fileName=this.options[this.selectedIndex].text,document.getElementById("rel").checked=!1,loadData()}function draw(t){var e=12*categories.length,a=20,n=20,i=30,r=globalWidth-(a+n),o=globalHeight-(+n+i+10+e),l=d3.layout.wordStream().size([r,o]).fontScale(d3.scale.linear()).minFontSize(globalMinFont).maxFontSize(globalMaxFont).data(t).flag(globalFlag),s=l.boxes(),c=l.minSud(),d=l.maxSud();maxFreq=l.maxFreq(),svg.transition().duration(300).attr({width:globalWidth,height:globalHeight});var u=d3.svg.area().interpolate("cardinal").x(function(t){return t.x}).y0(function(t){return t.y0}).y1(function(t){return t.y0+t.y}),p=[];s.data.forEach(function(t){p.push(t.date)});var f=d3.scale.ordinal().domain(p).rangeBands([0,r]),m=d3.svg.axis().orient("bottom").scale(f);axisGroup.attr("transform","translate("+a+","+(o+n+10+e)+")"),styleAxis(axisGroup.call(m));var g=d3.scale.ordinal().domain(d3.range(0,p.length+1)).rangeBands([0,r+r/s.data.length]),h=d3.svg.axis().orient("bottom").scale(g);xGridlinesGroup.attr("transform","translate("+(a-r/s.data.length/2)+","+(o+n+10+e+i)+")"),styleGridlineNodes(xGridlinesGroup.call(h.tickSize(-o-10-e-i,0,0).tickFormat(""))),mainGroup.attr("transform","translate("+a+","+n+")");for(var y=mainGroup.append("g").attr("id","wordStreamG"),v=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("cardinal"),x=[],k=0;k<s.layers[0].length;k++){var w=Object.assign({},s.layers[0][k]);w.y=w.y0,x.push(w)}for(k=s.layers[s.layers.length-1].length-1;0<=k;k--){var D=Object.assign({},s.layers[s.layers.length-1][k]);D.y=D.y+D.y0,x.push(D)}var G=x.length,_=v(x.slice(0,G/2))+"L"+v(x.slice(G/2,G)).substring(1,v(x.slice(G/2,G)).length)+"Z";layerPath=mainGroup.append("path").attr("d",_).attr("visibility","hidden").attr("class","layerpath").attr({"fill-opacity":1,"stroke-opacity":0});var A=s.topics,b=mainGroup.selectAll(".curve").data(s.layers);b.exit().remove(),b.enter().append("path").attr("d",u).style("fill",function(t,e){return color(e)}).attr({class:"curve","fill-opacity":0,stroke:"black","stroke-width":0,topic:function(t,e){return A[e]}}),b.attr("d",u).style("fill",function(t,e){return color(e)}).attr({"fill-opacity":0,stroke:"black","stroke-width":0,topic:function(t,e){return A[e]}});var I,N=[];function S(){var i,t=mainGroup.selectAll(".word").data(N,function(t){return t.id});t.exit().remove(),t.enter().append("g").attr({transform:function(t){return"translate("+t.x+", "+t.y+")rotate("+t.rotate+")"}}).attr("class","word").append("text").text(function(t){return t.text}).attr({id:function(t){return t.id},class:"textData","font-family":"Arial","font-size":function(t){return t.fontSize},fill:function(t){return color(categories.indexOf(t.topic))},"fill-opacity":function(t){return opacity(t.sudden)},"text-anchor":"middle","alignment-baseline":"middle",topic:function(t){return t.topic},visibility:function(t){return t.placed?"visible":"hidden"}}),t.transition().duration(800).attr({transform:function(t){return"translate("+t.x+", "+t.y+")rotate("+t.rotate+")"}}).select("text").attr("font-size",function(t){return t.fontSize}).attr({visibility:function(t){return t.placed?"visible":"hidden"}}),mainGroup.selectAll(".connection").on("mouseover",function(){var t=d3.select(this);t.style("cursor","crosshair");var e=mainGroup.select("#"+t[0][0].__data__.sourceID),a=e.attr("fill"),n=mainGroup.select("#"+t[0][0].__data__.targetID),i=n.attr("fill");t.attr("stroke-width",4),e.attr({stroke:a,fill:a,"stroke-width":1.5}),n.attr({stroke:i,fill:i,"stroke-width":1.5})}),mainGroup.selectAll(".connection").on("mouseout",function(){var t=d3.select(this);t.style("cursor","crosshair");var e=mainGroup.select("#"+t[0][0].__data__.sourceID),a=mainGroup.select("#"+t[0][0].__data__.targetID);t.attr("stroke-width",I(t[0][0].__data__.weight)),e.attr({stroke:"none","stroke-width":0}),a.attr({stroke:"none","stroke-width":0})}),mainGroup.selectAll(".textData").on("mouseenter",function(){var t=d3.select(this);t.style("cursor","pointer"),i=t.attr("fill");var e=t.text(),a=t.attr("topic");mainGroup.selectAll(".textData").filter(function(t){return t&&t.text===e&&t.topic===a}).attr({stroke:i,"stroke-width":1})}),mainGroup.selectAll(".textData").on("mouseout",function(){var t=d3.select(this);t.style("cursor","default");var e=t.text(),a=t.attr("topic");mainGroup.selectAll(".textData").filter(function(t){return t&&!t.cloned&&t.text===e&&t.topic===a}).attr({stroke:"none","stroke-width":"0"})}),mainGroup.selectAll(".textData").on("click",function(){var t=d3.select(this),e=t.text(),o=t.attr("topic"),a=mainGroup.selectAll(".textData").filter(function(t){return t&&t.text===e&&t.topic===o}),n=d3.select("path[topic='"+o+"']")[0][0].__data__,l=Array();n.forEach(function(t){l.push({x:t.x,y0:t.y0+t.y,y:0})}),a[0].forEach(function(t){var e=t.__data__,a=e.fontSize,n=l[e.timeStep+1];n.y=-e.streamHeight;var i=t.cloneNode(!0);d3.select(i).attr({visibility:"visible",stroke:"none","stroke-size":0});var r=t.parentNode.cloneNode(!1);r.appendChild(i),t.parentNode.parentNode.appendChild(r),d3.select(r).attr({cloned:!0,topic:o}).transition().duration(300).attr({transform:function(){return"translate("+n.x+","+(n.y0+n.y-a/2)+")"}})}),l[0].y=l[1].y,l[l.length-1].y=l[l.length-2].y,y.append("path").datum(l).attr("d",u).style("fill",i).attr({"fill-opacity":i,stroke:"black","stroke-width":.3,topic:o,wordStream:!0}),mainGroup.selectAll(".textData").filter(function(t){return t&&!t.cloned&&t.topic===o}).attr("visibility","hidden")}),A.forEach(function(e){d3.select("path[topic='"+e+"']").on("click",function(){mainGroup.selectAll(".textData").filter(function(t){return t&&!t.cloned&&t.placed&&t.topic===e}).attr({visibility:"visible"}),document.querySelectorAll("g[cloned='true'][topic='"+e+"']").forEach(function(t){t.parentNode.removeChild(t)}),document.querySelectorAll("path[wordStream='true'][topic='"+e+"']").forEach(function(t){t.parentNode.removeChild(t)})})}),legendGroup.attr("transform","translate("+a+","+(o+n+10)+")");var e=legendGroup.selectAll("g").data(s.topics).enter().append("g").attr("transform",function(t,e){return"translate(10,"+12*e+")"});e.append("circle").attr({r:5,fill:function(t,e){return color(e)},"fill-opacity":1,stroke:"black","stroke-width":.5}),e.append("text").text(function(t){return t}).attr({"font-size":12,"alignment-baseline":"middle",dx:8}),spinner.stop()}d3.map(s.data,function(e){s.topics.forEach(function(t){N=N.concat(e.words[t])})}),allW=JSON.parse(JSON.stringify(N)),opacity=d3.scale.log().domain([c,d]).range([.4,1]),0<=fileName.indexOf("Huffington")?d3.json("data/linksHuff2012.json",function(t,e){var a=e.filter(function(t){return 5<t.weight}),n=document.getElementById("rel").checked;a.forEach(function(t){t.sourceID=t.sourceID.split(".").join("_").split(" ").join("_"),t.targetID=t.targetID.split(".").join("_").split(" ").join("_")});var i=[];a.forEach(function(e){var t=N.find(function(t){return t.id===e.sourceID&&!0===t.placed}),a=N.find(function(t){return t.id===e.targetID&&!0===t.placed});void 0!==t&&void 0!==a&&i.push({sourceX:t.x,sourceY:t.y,targetX:a.x,targetY:a.y,weight:e.weight,sourceID:e.sourceID,targetID:e.targetID,id:e.sourceID+"_"+e.targetID})}),I=d3.scale.linear().domain(d3.extent(i,function(t){return t.weight})).range([.5,3]),opacScale=d3.scale.linear().domain(d3.extent(i,function(t){return t.weight})).range([.5,1]);var r=mainGroup.selectAll(".connection").data(i,function(t){return t.id});r.exit().remove(),r.enter().append("line").attr("class","connection"),r.transition().duration(800).attr("opacity",n?1:0).attr({x1:function(t){return t.sourceX},y1:function(t){return t.sourceY},x2:function(t){return t.targetX},y2:function(t){return t.targetY},stroke:"#444444","stroke-opacity":function(t){return opacScale(t.weight)},"stroke-width":function(t){return I(t.weight)}}),S()}):S()}function styleAxis(t){t.selectAll(".domain").attr({fill:"none"}),t.selectAll(".tick line").attr({fill:"none"}),t.selectAll(".tick text").attr({"font-family":"serif","font-size":15})}function styleGridlineNodes(t){t.selectAll(".domain").attr({fill:"none",stroke:"none"}),t.selectAll(".tick line").attr({fill:"none","stroke-width":.7,stroke:"lightgray"})}addDatasetsOptions();
//# sourceMappingURL=main.min.js.map
